# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏ chunks

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ chunks –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

–ï—Å–ª–∏ chunks –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**, –≤ –ª–æ–≥–∞—Ö –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
üî• Starting warming 1600 URLs with 2 repeat(s) (chunk size: 400)
üì¶ Split into 4 chunks for parallel warming
üöÄ Launching 4 chunks in PARALLEL...
üì¶ Chunk 1/4: START warming 400 URLs (2 repeats)
üì¶ Chunk 2/4: START warming 400 URLs (2 repeats)
üì¶ Chunk 3/4: START warming 400 URLs (2 repeats)
üì¶ Chunk 4/4: START warming 400 URLs (2 repeats)
‚è≥ Waiting for all 4 chunks to complete...
üì¶ Chunk 1/4: repeat 1/2
üì¶ Chunk 2/4: repeat 1/2
üì¶ Chunk 3/4: repeat 1/2
üì¶ Chunk 4/4: repeat 1/2
‚úÖ Warmed https://... (URL –∏–∑ chunk 1)
‚úÖ Warmed https://... (URL –∏–∑ chunk 2)
‚úÖ Warmed https://... (URL –∏–∑ chunk 3)
‚úÖ Warmed https://... (URL –∏–∑ chunk 4)
... (–≤–ø–µ—Ä–µ–º–µ—à–∫—É URL –∏–∑ –≤—Å–µ—Ö chunks)
üì¶ Chunk 1/4: repeat 2/2
üì¶ Chunk 2/4: repeat 2/2
...
‚úÖ Chunk 1/4 COMPLETED in 123.4s
‚úÖ Chunk 3/4 COMPLETED in 125.1s
‚úÖ Chunk 2/4 COMPLETED in 126.7s
‚úÖ Chunk 4/4 COMPLETED in 127.2s
üéâ All 4 chunks finished!
‚ú® Warming completed
```

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏:**

1. –í—Å–µ "START" –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
2. URL –∏–∑ —Ä–∞–∑–Ω—ã—Ö chunks –∏–¥—É—Ç –≤–ø–µ—Ä–µ–º–µ—à–∫—É
3. Chunks –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ –æ–¥–Ω–æ –≤—Ä–µ–º—è (¬±–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥)

---

### –ï—Å–ª–∏ chunks –ù–ï –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã

–í—ã —É–≤–∏–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:

```
üì¶ Chunk 1/4: START warming 400 URLs
‚úÖ Warmed https://... (—Ç–æ–ª—å–∫–æ chunk 1)
‚úÖ Warmed https://... (—Ç–æ–ª—å–∫–æ chunk 1)
...
‚úÖ Chunk 1/4 COMPLETED
üì¶ Chunk 2/4: START warming 400 URLs  ‚Üê –ù–∞—á–∞–ª—Å—è –ü–û–°–õ–ï –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è chunk 1
‚úÖ Warmed https://... (—Ç–æ–ª—å–∫–æ chunk 2)
...
```

---

## –ö–æ–¥, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å

### –í `warmer.py`:

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
chunk_tasks = [
    self.warm_chunk(chunk, client, semaphore, i + 1, total_chunks)
    for i, chunk in enumerate(chunks)
]
chunks_results = await asyncio.gather(*chunk_tasks)
```

`asyncio.gather()` –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏ –∂–¥–µ—Ç –∏—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```python
# –¢–∞–∫ –¥–µ–ª–∞—Ç—å –ù–ï –ù–ê–î–û
for i, chunk in enumerate(chunks):
    results = await self.warm_chunk(chunk, ...)  # –ñ–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç –Ω–∞ –±–æ–ª—å—à–æ–º –¥–æ–º–µ–Ω–µ

–í–æ–∑—å–º–µ–º –¥–æ–º–µ–Ω —Å 1600 URL, chunk_size=400 (4 chunks):

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:**

- Chunk 1: 10 –º–∏–Ω—É—Ç
- Chunk 2: 10 –º–∏–Ω—É—Ç
- Chunk 3: 10 –º–∏–Ω—É—Ç
- Chunk 4: 10 –º–∏–Ω—É—Ç
- **–ò—Ç–æ–≥–æ: 40 –º–∏–Ω—É—Ç**

**–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:**

- –í—Å–µ 4 chunks –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ: 10 –º–∏–Ω—É—Ç –∫–∞–∂–¥—ã–π
- **–ò—Ç–æ–≥–æ: ~10-12 –º–∏–Ω—É—Ç** (–Ω–µ–º–Ω–æ–≥–æ –¥–æ–ª—å—à–µ –∏–∑-–∑–∞ concurrency limit)

–ï—Å–ª–∏ –≤–∞—à –ø—Ä–æ–≥—Ä–µ–≤ –∑–∞–Ω–∏–º–∞–µ—Ç ~10-12 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 40, –∑–Ω–∞—á–∏—Ç chunks —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ! ‚úÖ

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏

### Semaphore (Concurrency)

Chunks –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –Ω–æ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ chunk —Ä–∞–±–æ—Ç–∞–µ—Ç **–æ–±—â–∏–π** `semaphore`:

```python
semaphore = asyncio.Semaphore(self.concurrency)  # –ù–∞–ø—Ä–∏–º–µ—Ä, 5
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:

- –í—Å–µ chunks –¥–µ–ª—è—Ç –º–µ–∂–¥—É —Å–æ–±–æ–π –ª–∏–º–∏—Ç –≤ 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ï—Å–ª–∏ —É –≤–∞—Å 4 chunks √ó 5 concurrency = —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ 20 –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–æ –∏–∑-–∑–∞ –æ–±—â–µ–≥–æ semaphore –±—É–¥–µ—Ç –≤—Å–µ–≥–æ 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ—á–µ–º—É —Ç–∞–∫ —Å–¥–µ–ª–∞–Ω–æ?

1. **–ó–∞—â–∏—Ç–∞ —Ü–µ–ª–µ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞** - –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ–º —Å–∞–π—Ç —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤
2. **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** - `WARMER_CONCURRENCY` –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –æ–±—â—É—é –Ω–∞–≥—Ä—É–∑–∫—É

### –ú–æ–∂–Ω–æ –ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å?

–î–∞! –£–≤–µ–ª–∏—á—å—Ç–µ `WARMER_CONCURRENCY`:

```env
# –ë—ã–ª–æ
WARMER_CONCURRENCY=5

# –°—Ç–∞–ª–æ (–¥–ª—è 4 chunks)
WARMER_CONCURRENCY=20  # 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ chunk
```

**–í–Ω–∏–º–∞–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à —Å–µ—Ä–≤–µ—Ä –∏ —Ü–µ–ª–µ–≤–æ–π —Å–∞–π—Ç —Å–ø—Ä–∞–≤—è—Ç—Å—è —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π!

---

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –°–∏–º–ø—Ç–æ–º: Chunks –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **–ü—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `await` –≤ —Ü–∏–∫–ª–µ –≤–º–µ—Å—Ç–æ `gather()`
2. **–û–¥–∏–Ω event loop** - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≥–¥–µ-—Ç–æ –≤ –∫–æ–¥–µ

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `asyncio.gather(*tasks)`

### –°–∏–º–ø—Ç–æ–º: Chunks –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **–ù–∏–∑–∫–∏–π WARMER_CONCURRENCY** - —É–≤–µ–ª–∏—á—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ
2. **–ú–µ–¥–ª–µ–Ω–Ω—ã–π —Ü–µ–ª–µ–≤–æ–π —Å–∞–π—Ç** - —Å–µ—Ä–≤–µ—Ä –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
3. **–°–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏** - –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º

**–†–µ—à–µ–Ω–∏–µ:**

```env
WARMER_CONCURRENCY=10  # –∏–ª–∏ –±–æ–ª—å—à–µ
WARMER_MIN_DELAY=0.3   # —É–º–µ–Ω—å—à–∏—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É
WARMER_MAX_DELAY=1.0
```

### –°–∏–º–ø—Ç–æ–º: URL –∏–¥—É—Ç –Ω–µ –≤–ø–µ—Ä–µ–º–µ—à–∫—É –∏–∑ chunks

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!**

–ò–∑-–∑–∞ `semaphore` –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –Ω–æ chunks –≤—Å–µ —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∑–∞–¥–∞—á.

–í–∞–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞:

- –í—Ä–µ–º—è START –≤—Å–µ—Ö chunks (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- –í—Ä–µ–º—è COMPLETED –≤—Å–µ—Ö chunks (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ)

---

## –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ chunks:

```
Time  Chunk 1  Chunk 2  Chunk 3  Chunk 4
0s    START    START    START    START
      ‚ñà‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà‚ñà
5s    ‚ñà‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà‚ñà
      ‚ñà‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà‚ñà
10s   DONE     DONE     DONE     DONE
```

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ chunks:

```
Time  Chunk 1  Chunk 2  Chunk 3  Chunk 4
0s    START
      ‚ñà‚ñà‚ñà‚ñà
5s    ‚ñà‚ñà‚ñà‚ñà
      DONE
10s            START
               ‚ñà‚ñà‚ñà‚ñà
15s            DONE
20s                     START
                        ‚ñà‚ñà‚ñà‚ñà
25s                     DONE
30s                              START
                                 ‚ñà‚ñà‚ñà‚ñà
35s                              DONE
```

---

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f app | grep -E "Chunk|START|COMPLETED"

# –°–º–æ—Ç—Ä–∏–º —Ç–æ–ª—å–∫–æ chunks
docker-compose logs app | grep "üì¶"

# –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è chunks
docker-compose logs app | grep "COMPLETED"
```

---

**–í—ã–≤–æ–¥:** –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ –≤—Å–µ "START" chunks –ø–æ—á—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ "COMPLETED" –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ –æ–¥–Ω–æ –≤—Ä–µ–º—è, –∑–Ω–∞—á–∏—Ç chunks —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ! ‚úÖ
